---
import Navbar from '../../components/Navbar.astro';
import Head from '../../components/Head.astro';
import Footer from '../../components/Footer.astro';
import listings from '../../data/db.json';

export async function getStaticPaths() {
  const paths = listings.map(listing => ({
    params: { id: listing.id.toString() }
  }));

  console.log('Generated paths:', paths);

  return paths;
}

export async function getStaticProps({ params }) {
  const listing = listings.find(listing => listing.id.toString() === params.id);

  console.log('Fetched listing:', listing);

  return {
    props: {
      listing
    }
  };
}

const id = Astro.params.id;
const listing = listings.find(listing => listing.id.toString() === id);
---

<html lang="en">
  <Head title={listing ? listing.name : 'Listing Details'} />
  <body class="bg-gray-200">
    <Navbar />
    <main class="container mx-auto p-6">
      {listing ? (
        <>
          <header class="mb-8">
            <h1 class="font-bold text-4xl text-gray-800">{listing.name}</h1>
          </header>
          <section class="flex flex-col md:flex-row mb-8">
            <img src={listing.image} alt={listing.name} class="w-full md:w-1/2 rounded-lg" />
            <div class="md:ml-8 mt-4 md:mt-0">
              <p class="text-gray-800 text-3xl font-bold mb-4">${listing.price}</p>
              <p class="text-gray-800 text-lg mb-2"><strong>Size:</strong> {listing.size} sqm</p>
              <p class="text-gray-800 text-lg mb-2"><strong>Bedrooms:</strong> {listing.bedrooms}</p>
              <p class="text-gray-800 text-lg mb-2"><strong>Description:</strong> {listing.desc}</p>
            </div>
          </section>
          <section class="contact-form mt-8">
            <h2 class="font-bold text-2xl text-gray-800 mb-4">Contact Seller</h2>
            <form>
              <div class="mb-4">
                <label for="name" class="block text-gray-800 font-bold mb-2">Name:</label>
                <input type="text" id="name" class="border p-2 rounded-lg w-full" required />
              </div>
              <div class="mb-4">
                <label for="email" class="block text-gray-800 font-bold mb-2">Email:</label>
                <input type="email" id="email" class="border p-2 rounded-lg w-full" required />
              </div>
              <div class="mb-4">
                <label for="message" class="block text-gray-800 font-bold mb-2">Message:</label>
                <textarea id="message" class="border p-2 rounded-lg w-full" rows="4" required></textarea>
              </div>
              <button type="submit" class="bg-gray-800 text-white px-4 py-2 rounded-lg">Send Message</button>
            </form>
          </section>
        </>
      ) : (
        <p class="text-center text-gray-500 text-2xl">Loading...</p>
      )}
    </main>
    <Footer />
  </body>
</html>